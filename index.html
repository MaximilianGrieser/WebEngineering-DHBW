<!DOCTYPE html>
<?xml version="1.0" encoding="UTF-8"?>

<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Bootstrap-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="CSS/style.css">
    <title>WebKalender</title>
    <link rel="shortcut icon" href="favicon.ico">
</head>

<body>
    <div id="screen">
        <!--Navbar-->
        <div class="navbar">
            <div class="title">Web Kalender</div>
            <div class="impressum">Impressum</div>
        </div>

        <div class="calender">
            <div class="month">
                <button class="prev-month button-month" onclick="prevMonth()">
                    <svg class="bi bi-chevron-compact-left" width="5em" height="5em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223z"/>
                    </svg>
                </button>
                <button class="next-month button-month" onclick="nextMonth()">
                    <svg class="bi bi-chevron-compact-right" width="5em" height="5em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"/>
                    </svg>
                </button>
                <p class="month-header" id="currMonth">Month</p>
            </div>

            <div class="days">
                <table class="days_table">
                    <tr>
                        <th id="weekday1">Monday</th>
                        <th id="weekday2">Tuesday</th>
                        <th id="weekday3">Wednesday</th>
                        <th id="weekday4">Thurday</th>
                        <th id="weekday5">Friday</th>
                        <th id="weekday6">Saturday</th>
                        <th id="weekday0">Sunday</th>
                    </tr>
                    <tr class="days-row0">
                        <td id="weekday_days_0_row_0">X</td>
                        <td id="weekday_days_1_row_0">X</td>
                        <td id="weekday_days_2_row_0">X</td>
                        <td id="weekday_days_3_row_0">X</td>
                        <td id="weekday_days_4_row_0">X</td>
                        <td id="weekday_days_5_row_0">X</td>
                        <td id="weekday_days_6_row_0">X</td>
                    </tr>
                    <tr class="days-row1">
                        <td id="weekday_days_0_row_1">X</td>
                        <td id="weekday_days_1_row_1">X</td>
                        <td id="weekday_days_2_row_1">X</td>
                        <td id="weekday_days_3_row_1">X</td>
                        <td id="weekday_days_4_row_1">X</td>
                        <td id="weekday_days_5_row_1">X</td>
                        <td id="weekday_days_6_row_1">X</td>
                    </tr>
                    <tr class="days-row2">
                        <td id="weekday_days_0_row_2">X</td>
                        <td id="weekday_days_1_row_2">X</td>
                        <td id="weekday_days_2_row_2">X</td>
                        <td id="weekday_days_3_row_2">X</td>
                        <td id="weekday_days_4_row_2">X</td>
                        <td id="weekday_days_5_row_2">X</td>
                        <td id="weekday_days_6_row_2">X</td>
                    </tr>
                    <tr class="days-row3">
                        <td id="weekday_days_0_row_3">X</td>
                        <td id="weekday_days_1_row_3">X</td>
                        <td id="weekday_days_2_row_3">X</td>
                        <td id="weekday_days_3_row_3">X</td>
                        <td id="weekday_days_4_row_3">X</td>
                        <td id="weekday_days_5_row_3">X</td>
                        <td id="weekday_days_6_row_3">X</td>
                    </tr>
                    <tr class="days-row4">
                        <td id="weekday_days_0_row_4">X</td>
                        <td id="weekday_days_1_row_4">X</td>
                        <td id="weekday_days_2_row_4">X</td>
                        <td id="weekday_days_3_row_4">X</td>
                        <td id="weekday_days_4_row_4">X</td>
                        <td id="weekday_days_5_row_4">X</td>
                        <td id="weekday_days_6_row_4">X</td>
                    </tr>
                    <tr class="days-row5">
                        <td id="weekday_days_0_row_5">X</td>
                        <td id="weekday_days_1_row_5">X</td>
                        <td id="weekday_days_2_row_5">X</td>
                        <td id="weekday_days_3_row_5">X</td>
                        <td id="weekday_days_4_row_5">X</td>
                        <td id="weekday_days_5_row_5">X</td>
                        <td id="weekday_days_6_row_5">X</td>
                    </tr>
                </table>
            </div>
        </div>

        <button class="add-calender-entry" onclick="newEntry()">
            <svg class="bi bi-plus-circle" width="4em" height="4em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z"/>
                <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            </svg>
        </button>
    </div>

    <!--Neuer Termin-->
    <div class="new-entry-form" id="new-entry-form">
        <form class="newEntry" id="newEntry">
            <table class="new-entry-form">
                <tr>
                    <td>
                        <input type="text" id="ftitle" name="title" value="Title">   
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>Start:</p>
                        <input type="date" id="fstartdate" name="startdate">
                        <input type="time" id="fstarttime" name="starttime">
                        <input type="checkbox" id="fganztag" name="ganztag" onclick="hideDateEnd()">
                        <label for="fganztag">Ganzt&auml;gig</label>
                    </td>
                    <td id="endDate">
                        <p>Ende:</p>
                        <input type="date" id="fenddate" name="enddate">
                        <input type="time" id="fendtime" name="endtime">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="textarea" id="fsummary" name="summary" value="Summary">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" id="flocation" name="location" value="Location">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="submit" value="Termin HinzufÃ¼gen">
                    </td>
                </tr>
            </table>
        </form>
    </div>

    <script>
        src="jquery-3.1.1.min.js"
        
        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var maxDaysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        
        var firstDayInNextMonth = 0;
        var firstDayInMonth = 5;

        var today = new Date();
        var selectedMonthIndex = today.getMonth();
        var todayDate = today.getDate();
        var todayDay = today.getDay();

        var daysGrid = [
            ["X","X","X","X","X","X","X"],
            ["X","X","X","X","X","X","X"],
            ["X","X","X","X","X","X","X"],
            ["X","X","X","X","X","X","X"],
            ["X","X","X","X","X","X","X"],
            ["X","X","X","X","X","X","X"]
        ]

        window.onload = function() {
            document.getElementById("currMonth").innerHTML = months[selectedMonthIndex];
            document.getElementById("weekday" + todayDay).classList.add("weekday-today");

            if(todayDay == 0){
                todayDay = 7;
            }

            var todayRow = getActualRow(todayDate, todayDay);
            todayElement = document.getElementById("weekday_days_" + (todayDay - 1)+ "_row_" + (todayRow - 1));
            todayElement.classList.add("day-today");
            
            fillDaysGrid(todayRow, todayDay, todayDate);
        }

        function getActualRow(date, weekday) {
            var row = Math.floor(date / 7);          
            if (weekday != 7) {
                row++;
            }
            return row;
        }

        function fillDaysGrid(pRow, pDay, pDate) {
            var currentRow = pRow;
            var currentDay = pDay -1;
            var currentDate = pDate;
            var notInMonth = false

            console.log(pRow,pDay,pDate);
            daysGrid[pRow -1][pDay -1] = pDate;

            for(i = currentRow; i >= 1; i--){
                for(y = currentDay; y >= 1; y--){
                    currentDate--;
                    if(currentDate < 1){
                        firstDayInMonth = (y +1);
                        currentDate = maxDaysInMonth[selectedMonthIndex -1];
                        notInMonth = true;
                    }
                    if(notInMonth){
                        document.getElementById("weekday_days_" + (y -1) + "_row_" + (i -1)).classList.add("day-not-in-month");
                    }
                    daysGrid[i -1][y -1] = currentDate;
                }
                currentDay = 7;
            }

            currentRow = pRow;
            currentDay = pDay +1;
            currentDate = pDate;
            notInMonth = false;           

            for(i = currentRow; i < 7; i++){
                for(y = currentDay; y <= 7; y++){
                    currentDate++;
                    if(currentDate > maxDaysInMonth[selectedMonthIndex]){
                        firstDayInNextMonth = y;
                        currentDate = 1;
                        notInMonth = true;
                    }
                    if(notInMonth){
                        document.getElementById("weekday_days_" + (y -1) + "_row_" +(i -1)).classList.add("day-not-in-month");
                    }
                    daysGrid[i -1][y -1] = currentDate;
                }
                currentDay = 1;
            }
            console.log(daysGrid);

            printDaysGrid();
        }

        function removeMonthSpecificClasses() {
            for(i = 0; i < 6; i++) {
                for(y = 0; y < 7; y++) {
                    document.getElementById("weekday_days_" + y + "_row_" + i).classList.remove("day-not-in-month");
                    document.getElementById("weekday_days_" + y + "_row_" + i).classList.remove("day-today");
                }
            }
        }

        function printDaysGrid() {
            for(i = 0; i < 6; i++) {
                for(y = 0; y < 7; y++) {
                    document.getElementById("weekday_days_" + y + "_row_" + i).innerHTML = daysGrid[i][y];
                }
            }
        }

        function nextMonth() {
            selectedMonthIndex++;
            if(selectedMonthIndex > 11) {
                selectedMonthIndex = 0
            }
            document.getElementById("currMonth").innerHTML = months[selectedMonthIndex];

            removeMonthSpecificClasses();
            fillDaysGrid(1, firstDayInNextMonth, 1);
        }

        function prevMonth() {
            selectedMonthIndex--;
            if(selectedMonthIndex < 1) {
                selectedMonthIndex = 11
            }
            document.getElementById("currMonth").innerHTML = months[selectedMonthIndex];
            
            removeMonthSpecificClasses();
            fillDaysGrid(1, firstDayInMonth , 1);
        }

        function newEntry() {
            document.getElementById("screen").classList.add("blur");
            document.getElementById("new-entry-form").style.display = "block";
        }

        function hideDateEnd() {
            var objekt = document.getElementById("endDate").classList;
            if(objekt.contains("blur")) {
                objekt.remove("blur")
            }else{
                objekt.add("blur")
            }
        }

        document.querySelector('form.newEntry').addEventListener('submit', function (e) {
        var entryForm = document.getElementById("newEntry");
        var entryFormData = new FormData(entryForm);

        var Entry = {};
        entryFormData.forEach(function(value, key){
            Entry[key] = value;
        });

        console.log(JSON.stringify(Entry));
        });
    </script>
</body>

</html>